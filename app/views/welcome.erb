<section id="home">
  <% if @error %>
    <p class="error"><%= @error %></p>
  <% end %>
  <div class="inner-width">
    <div class="find-content">
      <form action="/find" name="find-form" method="post" autocomplete="off">
          <div class="text-input">
            <div class="icon-div">
              <i class="fa-solid fa-magnifying-glass"></i>
            </div>
            <div class="searching-bar">
              <input type="text" id="search-input" name="search-input" placeholder="Enter Key">
              <div id="result-div" class="result-div"></div>
            </div>
          </div>
          <input type="submit" value="Szukaj" id="find-submit" name="submit">
        </form>
    </div>
  </div>
</section>

<script>
"use strict";
function isEmpty(obj) {
    return Object.keys(obj).length === 0;
}

window.onload = function () {
  const input = _('search-input');
  input.addEventListener('input', updateValue);
	let res = _('result-div');
  function updateValue(e) {
    let post_data = e.target.value;
    const xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
      if (xhr.readyState == XMLHttpRequest.DONE) {
        const obj = JSON.parse(xhr.responseText);
        res.innerHTML = '';
        let list = '';
        let terms = [];
        obj.forEach(obj => {
            Object.entries(obj).forEach(([key, value]) => {
              terms.push(value);
            });
          });
        for (var i=0; i<terms.length; i++) {
          list += '<li>' + terms[i] + '</li>';
        }
        res.innerHTML = '<ul>' + list + '</ul>';
        res.style.display = 'block';
      }
    }
    xhr.addEventListener('error', (event) => {
      alert('Oops! Something went wrong.');
    });
    if(!isEmpty(post_data)){
      xhr.open("POST", "/find", true);
      xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
      xhr.send("phrase="+post_data);
    } else {
      res.innerHTML = '';
      res.style.display = 'none';
    }
  }
}

function _(el){
 return document.getElementById(el);
}
</script>
